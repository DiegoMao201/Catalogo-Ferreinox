<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Ferreinox - Portfolio Profesional</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <header class="catalog-header">
        <h1 class="catalog-title">FERREINOX</h1>
        <p class="catalog-subtitle">Catálogo Profesional de Productos</p>
    </header>
    
    <main id="productsContainer" class="catalog-container">
        <div class="loading-placeholder">
            Cargando productos desde el archivo Excel...
        </div>
    </main>

    <script>
        // Variable global para almacenar todos los productos
        let allProducts = [];

        // CAMBIO 2: La función loadProductData fue reescrita para leer un archivo .xlsx
        async function loadProductData() {
            const excelFilePath = 'Abracol.xlsx'; // Apunta a tu archivo de Excel
            
            try {
                const response = await fetch(excelFilePath);
                if (!response.ok) {
                    throw new Error("No se pudo encontrar el archivo: " + response.statusText);
                }
                
                // Leemos el archivo como un buffer de datos binarios
                const arrayBuffer = await response.arrayBuffer();
                
                // Usamos la librería XLSX (SheetJS) para leer el buffer
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                // Obtenemos el nombre de la primera hoja
                const firstSheetName = workbook.SheetNames[0];
                
                // Obtenemos la hoja de trabajo
                const worksheet = workbook.Sheets[firstSheetName];
                
                // Convertimos los datos de la hoja a un formato JSON (array de objetos)
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                allProducts = jsonData;
                console.log("Productos cargados desde Excel:", allProducts);
                
                // El resto del código funciona igual, ¡ahora con datos de Excel!
                displayProducts(allProducts);

            } catch (error) {
                console.error('Error al cargar el archivo Excel:', error);
                const container = document.getElementById('productsContainer');
                container.innerHTML = `<div class="error-placeholder">Error al cargar productos. Asegúrate de que 'Abracol.xlsx' exista y tenga el formato correcto.</div>`;
            }
        }
        
        // Función para generar las estrellas de calificación (sin cambios)
        function getRatingStars(productName) {
            let rating = 4;
            if (!productName) return '☆'.repeat(5);

            const lowerCaseName = productName.toLowerCase();
            
            if (lowerCaseName.includes('premium') || lowerCaseName.includes('abracol')) {
                rating = 5;
            } else if (lowerCaseName.includes('pro')) {
                rating = 4;
            } else {
                rating = 3;
            }
            
            return '★'.repeat(rating) + '☆'.repeat(5 - rating);
        }

        // Función para mostrar los productos (sin cambios en su lógica interna)
        function displayProducts(products) {
            const container = document.getElementById('productsContainer');
            
            if (!products || products.length === 0) {
                container.innerHTML = `<div class="error-placeholder">No se encontraron productos en el archivo.</div>`;
                return;
            }
            
            let html = '';
            
            products.forEach(product => {
                html += `
                <div class="product-card">
                    <div class="product-top-section">
                        <div class="image-container">
                            <img src="images/productos/${product.subcategoria}/${product.imagen}" 
                                 alt="${product.nombre}" 
                                 class="product-image"
                                 onerror="this.src='https://via.placeholder.com/150x150?text=Ferreinox'">
                        </div>
                        <div class="content-container">
                            <div class="product-title">${(product.nombre || 'Producto').toUpperCase()}</div>
                            <div class="product-info">
                                <span class="product-segment">${(product.categoria || 'General').toUpperCase()}</span>
                                <span class="product-rating">${getRatingStars(product.nombre)}</span>
                            </div>
                            <div class="product-description">
                                ${product.descripcion || 'Descripción no disponible.'}
                            </div>
                        </div>
                    </div>
                    <div class="specifications-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>REFERENCIA</th>
                                    <th>DESCRIPCIÓN</th>
                                    <th>GRANO</th>
                                    <th>FAMILIA</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>${product.codigo || 'N/A'}</td>
                                    <td>${product.nombre || 'N/A'}</td>
                                    <td>${product.presentacion || 'N/A'}</td>
                                    <td>${product.subcategoria || 'N/A'}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Cargar datos al iniciar la página
        document.addEventListener('DOMContentLoaded', loadProductData);
    </script>
</body>
</html>
